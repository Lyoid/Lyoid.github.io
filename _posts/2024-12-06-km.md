---
title: 二部图匹配用于结构化感知车道线与地图拓扑匹配
author: lyoid
date: 2024-12-06 14:10:00 +0800
categories: [Algo]
tags: [Fusion Localization]
render_with_liquid: false
---
# 问题
感知结果化数据与地图数据拓扑匹配

# 算法介绍
匈牙利匹配算法（Hungarian Algorithm），也称为Munkres算法或Kuhn-Munkres算法，是一种用于解决二分图匹配问题和最优分配问题的算法。它的主要目标是找到一个最小权重匹配或最大权重匹配，它的核心思想是通过增广路径来逐步改善当前匹配，直到找到最优解。以下是匈牙利算法的基本步骤：

1. 初始化匹配：首先，初始化一个空的匹配，通常是将所有边的匹配状态设为未匹配。
2. 寻找增广路径：从未匹配的顶点开始，使用深度优先搜索（DFS）或广度优先搜索（BFS）寻找增广路径。增广路径是指从一个未匹配的顶点出发，经过一系列匹配和未匹配的边，最终回到另一个未匹配的顶点的路径。
3. 增广匹配：一旦找到增广路径，就可以通过翻转路径上的边的匹配状态来增加匹配的大小。具体来说，路径上的未匹配边变为匹配边，而路径上的匹配边变为未匹配边。
4. 重复过程：重复寻找增广路径和增广匹配的过程，直到无法再找到增广路径为止。
5. 输出结果：最终得到的匹配就是最大匹配。

匈牙利算法的时间复杂度为O(n^3)，其中n是顶点的数量。它不仅适用于二分图匹配问题，还可以扩展到更一般的图匹配问题。这个算法在实际应用中，如任务分配、资源调度等场景中，具有广泛的应用价值。

# 问题建模
![匹配示意图](/assets/images/km/image1.png)

以上图为例：
- 将每个地图车道线boundary作为左图节点，将车道线颜色、虚实、类别、空间位置作为节点特征。
  - 将左图节点设置为4个，不足四条地图车道线则虚拟车道线，构建虚拟节点。特征向量为全为极大值
- 将每个感知车道线实例作为右图节点，将车道线颜色、虚实、类别、空间位置作为节点特征。
  - 将右图节点设置为4个，不足四条感知车道线则虚拟车道线，构建虚拟节点。特征向量为全为极大值.
- 将左图与右图节点设置成全联通的状态，计算每个左图节点到右图节点的特征距离，构建边的权重。

# 问题解法
增广路方法需要记录内容有：
- 单次匹配最小loss
- 单次匹配访问过的vision与map节点
- 当前所有节点的匹配信息

单个节点匹配逻辑：
- 对于未访问过的map节点，找自己和map节点和等于边权值的匹配。
- 若找到，标记为已访问。并判断是否为已匹配点。
  - 若是，则找它对应的vision匹配点并做如上操作。
  - 若否，则找到此vision点对应map匹配。return true。
- 若未找到，记录最小loss。并返回上一级递归。
- 若最终未找到，用loss更新所有访问过的vision点和map点。再重新开始检索。